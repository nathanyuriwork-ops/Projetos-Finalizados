<html>
<head>
<title>FxController.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
FxController.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com</span><span class="s2">.</span><span class="s1">nathanyuri</span><span class="s2">.</span><span class="s1">audio</span><span class="s2">.</span><span class="s1">controller</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">com</span><span class="s2">.</span><span class="s1">nathanyuri</span><span class="s2">.</span><span class="s1">audio</span><span class="s2">.</span><span class="s1">model</span><span class="s2">.</span><span class="s1">ConversionRequest</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">com</span><span class="s2">.</span><span class="s1">nathanyuri</span><span class="s2">.</span><span class="s1">audio</span><span class="s2">.</span><span class="s1">service</span><span class="s2">.</span><span class="s1">FfmpegService</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">javafx</span><span class="s2">.</span><span class="s1">application</span><span class="s2">.</span><span class="s1">Platform</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">javafx</span><span class="s2">.</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">control</span><span class="s2">.</span><span class="s1">Label</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">javafx</span><span class="s2">.</span><span class="s1">scene</span><span class="s2">.</span><span class="s1">control</span><span class="s2">.</span><span class="s1">TextField</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">javafx</span><span class="s2">.</span><span class="s1">stage</span><span class="s2">.</span><span class="s1">FileChooser</span><span class="s2">;</span>

<span class="s0">import </span><span class="s1">java</span><span class="s2">.</span><span class="s1">io</span><span class="s2">.</span><span class="s1">File</span><span class="s2">;</span>

<span class="s0">public class </span><span class="s1">FxController </span><span class="s2">{</span>

    <span class="s0">private final </span><span class="s1">FfmpegService ffmpegService </span><span class="s2">= </span><span class="s0">new </span><span class="s1">FfmpegService</span><span class="s2">();</span>

    <span class="s0">public void </span><span class="s1">chooseFile</span><span class="s2">(</span><span class="s1">TextField fileField</span><span class="s2">) {</span>

        <span class="s1">FileChooser chooser </span><span class="s2">= </span><span class="s0">new </span><span class="s1">FileChooser</span><span class="s2">();</span>
        <span class="s1">chooser</span><span class="s2">.</span><span class="s1">getExtensionFilters</span><span class="s2">().</span><span class="s1">add</span><span class="s2">(</span>
                <span class="s0">new </span><span class="s1">FileChooser</span><span class="s2">.</span><span class="s1">ExtensionFilter</span><span class="s2">(</span><span class="s3">&quot;Áudio&quot;</span><span class="s2">, </span><span class="s3">&quot;*.wav&quot;</span><span class="s2">, </span><span class="s3">&quot;*.mp3&quot;</span><span class="s2">, </span><span class="s3">&quot;*.flac&quot;</span><span class="s2">)</span>
        <span class="s2">);</span>

        <span class="s1">File file </span><span class="s2">= </span><span class="s1">chooser</span><span class="s2">.</span><span class="s1">showOpenDialog</span><span class="s2">(</span><span class="s0">null</span><span class="s2">);</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">file </span><span class="s2">!= </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">fileField</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s1">file</span><span class="s2">.</span><span class="s1">getAbsolutePath</span><span class="s2">());</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">public void </span><span class="s1">convert</span><span class="s2">(</span><span class="s1">String filePath</span><span class="s2">,</span>
                        <span class="s1">String originalHz</span><span class="s2">,</span>
                        <span class="s1">String targetHz</span><span class="s2">,</span>
                        <span class="s1">Label statusLabel</span><span class="s2">) {</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">filePath </span><span class="s2">== </span><span class="s0">null </span><span class="s2">|| </span><span class="s1">filePath</span><span class="s2">.</span><span class="s1">isEmpty</span><span class="s2">()) {</span>
            <span class="s1">statusLabel</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s3">&quot;Selecione um arquivo.&quot;</span><span class="s2">);</span>
            <span class="s0">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">statusLabel</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s3">&quot;Convertendo...&quot;</span><span class="s2">);</span>

        <span class="s0">new </span><span class="s1">Thread</span><span class="s2">(() </span><span class="s1">-&gt; </span><span class="s2">{</span>
            <span class="s0">try </span><span class="s2">{</span>
                <span class="s0">double </span><span class="s1">oHz </span><span class="s2">= </span><span class="s1">Double</span><span class="s2">.</span><span class="s1">parseDouble</span><span class="s2">(</span><span class="s1">originalHz</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">','</span><span class="s2">, </span><span class="s3">'.'</span><span class="s2">));</span>
                <span class="s0">double </span><span class="s1">tHz </span><span class="s2">= </span><span class="s1">Double</span><span class="s2">.</span><span class="s1">parseDouble</span><span class="s2">(</span><span class="s1">targetHz</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">','</span><span class="s2">, </span><span class="s3">'.'</span><span class="s2">));</span>
                <span class="s0">double </span><span class="s1">gainDb </span><span class="s2">= </span><span class="s4">3.0</span><span class="s2">;</span>

                <span class="s1">File inputFile </span><span class="s2">= </span><span class="s0">new </span><span class="s1">File</span><span class="s2">(</span><span class="s1">filePath</span><span class="s2">);</span>

                <span class="s1">String fileName </span><span class="s2">= </span><span class="s1">inputFile</span><span class="s2">.</span><span class="s1">getName</span><span class="s2">();</span>
                <span class="s1">String parentDir </span><span class="s2">= </span><span class="s1">inputFile</span><span class="s2">.</span><span class="s1">getParent</span><span class="s2">();</span>

                <span class="s0">int </span><span class="s1">dotIndex </span><span class="s2">= </span><span class="s1">fileName</span><span class="s2">.</span><span class="s1">lastIndexOf</span><span class="s2">(</span><span class="s3">'.'</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">dotIndex </span><span class="s2">== -</span><span class="s4">1</span><span class="s2">) {</span>
                    <span class="s0">throw new </span><span class="s1">RuntimeException</span><span class="s2">(</span><span class="s3">&quot;Arquivo sem extensão válida.&quot;</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s1">String baseName </span><span class="s2">= </span><span class="s1">fileName</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">dotIndex</span><span class="s2">);</span>
                <span class="s1">String extension </span><span class="s2">= </span><span class="s1">fileName</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">dotIndex</span><span class="s2">);</span>

                <span class="s1">String outputPath </span><span class="s2">= </span><span class="s1">parentDir </span><span class="s2">+ </span><span class="s1">File</span><span class="s2">.</span><span class="s1">separator </span><span class="s2">+</span>
                        <span class="s1">baseName </span><span class="s2">+ </span><span class="s3">&quot;_(&quot; </span><span class="s2">+ </span><span class="s1">tHz </span><span class="s2">+ </span><span class="s3">&quot;hz)&quot; </span><span class="s2">+ </span><span class="s1">extension</span><span class="s2">;</span>

                <span class="s1">ConversionRequest request </span><span class="s2">= </span><span class="s0">new </span><span class="s1">ConversionRequest</span><span class="s2">(</span>
                        <span class="s1">inputFile</span><span class="s2">.</span><span class="s1">getAbsolutePath</span><span class="s2">(),</span>
                        <span class="s1">outputPath</span><span class="s2">,</span>
                        <span class="s1">oHz</span><span class="s2">,</span>
                        <span class="s1">tHz</span><span class="s2">,</span>
                        <span class="s1">gainDb</span>
                <span class="s2">);</span>

                <span class="s1">ffmpegService</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>

                <span class="s1">Platform</span><span class="s2">.</span><span class="s1">runLater</span><span class="s2">(() </span><span class="s1">-&gt;</span>
                        <span class="s1">statusLabel</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s3">&quot;Conversão concluída!&quot;</span><span class="s2">)</span>
                <span class="s2">);</span>

            <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">Exception e</span><span class="s2">) {</span>
                <span class="s1">Platform</span><span class="s2">.</span><span class="s1">runLater</span><span class="s2">(() </span><span class="s1">-&gt;</span>
                        <span class="s1">statusLabel</span><span class="s2">.</span><span class="s1">setText</span><span class="s2">(</span><span class="s3">&quot;Erro: &quot; </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">getMessage</span><span class="s2">())</span>
                <span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}).</span><span class="s1">start</span><span class="s2">();</span>
    <span class="s2">}</span>
<span class="s2">}</span>
</pre>
</body>
</html>